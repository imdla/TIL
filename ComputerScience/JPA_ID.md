> 💡 **한 줄 요약**
>
> JPA에서 ID를 생성하기 위한 방식으로 직접 할당과 자동 할당이 있다.
>
> 직접 할당은 `@Id` 어노테이션만 사용해 Id 값을 직접 할당하고, 자동 할당은 `@Id` 와 `@GeneratedValue` 를 함께 사용해 원하는 키 생성 전략을 선택한다.
>
> 자동 생성 방식에서 IDENTITY 전략은 기본 키 생성을 DB에 위임하는 전략이고, SEQUENCE 전략은 시퀀스 키 생성 전략을 지원하는 DB에서 사용할 수 있다. TABLE 전략은 키 생성 전용 테이블을 만들어 시퀀스를 흉내내는 전략이다. AUTO 전략은 데이터베이스의 방언에 따라 위의 3가지 중 하나를 자동으로 선택해 데이터베이스 변경 시 코드를 수정할 필요가 없다.

### 1. 🤔 왜 사용하는가

- **JPA에서 ID를 생성하기위한 방식**
  1. **직접 할당**
     - `@Id` 어노테이션만 사용해 Id 값을 직접 할당하는 방식
  2. **자동 할당**
     - `@Id` 와 `@GeneratedValue` 를 함께 사용해 원하는 키 생성 전략을 선택하는 방식
     - `@GeneratedValue` 의 stretagy 옵션을 통해 생성 전략 선택 가능

### 2. 💡 무엇인지 아는가(특징)

> **자동 생성 방식의 각 전략**

1. **IDENTITY 전략**

   - 기본 키 생성을 DB에 위임하는 전략
   - MySQL, PostgreSQL, SQL Server, DB2에서 사용
   - 배치 인서트 불가

   > **과정**

   - 엔티티 생성 시 쓰기 지연이 적용되지 않음
     - JPA에서 엔티티를 영속하기 위해 식별자가 필요
     - IDENTITY 전략에서 이 식별자가 DB에 저장되어야 할당되기 때문
   - 엔티티 생성 시 즉시 INSERT 쿼리가 실행되어야 함
   - 하이버네이트 사용시 INSERT 쿼리의 결과를 다시 조회하지 않기 위해 내부적으로 Statement.getGeneratedKeys를 사용

1. **SEQUENCE 전략**

   - 시퀀스 키 생성 전략을 지원하는 DB에서 사용 가능
     - 데이터베이스 시퀀스 : 유일한 값을 자동으로 생성하게 하는 객체
   - `@SequenceGenerator` 를 사용해 어떤 시퀀스 사용할지 지정 가능

   > **과정**

   - em.persist() 호출 시 먼저 데이터베이스의 시퀀스를 이용해 식별자 조회
     → 조회한 식별자를 엔티티에 할당 후 엔티티를 영속성 컨텍스트에 저장
     → 트랜잭션 커밋해 플러시 발생 시 엔티티를 저장함

1. **TABLE 전략**

   - 키 생성 전용 테이블을 만들어 시퀀스를 흉내내는 전략
   - `@TableGenerator` 를 사용해 어떤 테이블 사용할 것인지 설정
   - SEQUENCE 전략보다 DB와 한번 더 통신
     - 단점 : 성능 좋지 않음
     - 장점 : 모든 DB에 적용 가능

   > **과정**

   - 값을 조회하며 SELECT 쿼리를 사용하며 증가를 위해 UPDATE 쿼리를 사용

1. **AUTO 전략**
   - 데이터베이스 방언에 따라 IDENTITY, SEQUENCE, TABLE 중 하나를 자동으로 선택
   - 장점 : 데이터베이스를 변경해도 코드를 수정할 필요 없음
