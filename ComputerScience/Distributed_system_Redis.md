> 💡 **한 줄 요약**
>
> 분산 환경에서 Redis를 활용해 잠금 구현을 사용하기 위해 SET 명령어로 분산 잠금을 구현할 수 있다.

### 1. 🤔 왜 사용하는가

- **분산 환경에서 Redis 활용한 잠금 구현**
  → SET 명령어 사용해 분산 잠금
  1. 1대 이상의 서버가 특정 Key에 대해 SET 명령어에 대해 NX 옵션을 추가해 Redis에 전달하여 잠금 획득을 시도
  2. NX 옵션 사용 시 특정 Key에 해당하는 값이 존재하지 않는 경우에만 값 추가 작업이 성공
  3. SET 작업을 성공적으로 수행한 서버 → 잠금을 획득
  4. 잠금을 획득한 서버는 작업이 끝난 이후, Key에 해당하는 값을 제거해 잠금을 해제

### 2. 💡 무엇인지 아는가(특징)

> **잠금이 유실될 가능성**

- 레플리케이션 구성으로 이루어져 있을 경우 → 잠금 유실 가능성 존재
  - ex. 마스터 노드 존재, 레플리카 노드에 주기적으로 데이터를 복제하는 구성일 경우
    - 특정 서버가 잠금을 획득하고 작업 수행 도중 마스터 노드에 장애가 발생
    - 레플리카 노드가 마스터 노드로 승격 가능 (failover)
  - ex. 기존 마스터 노드가 가지고 있던 잠금용 데이터를 레플리카 노드가 가지고 있지 않을 경우
    - 작업을 처리하고 있는 서버의 잠금이 유실됨
    - 복제 지연으로 인해 분산 잠금의 상호 배제라는 특성 잃음
      → 문제 해결 : RedLock 알고리즘 등장

### 3. 🔄 개선 방법

> **RedLock 알고리즘**

- 1대 이상의 단일 레디스 노드들을 이용해 분산 잠금 구현
- 과반수 이상의 노드에 잠금을 획득할 경우, 잠금을 획득하는 것으로 간주
- ex. 5개의 단일 레디스 노드가 존재할 경우
  - 작업 서버가 모든 노드에게 잠금 획득을 시도
  - 3개 노드에서 잠금 획득 시 → 분산 잠금을 획득한 것으로 판단
