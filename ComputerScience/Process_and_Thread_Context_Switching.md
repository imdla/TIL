> 💡 **한 줄 요약**
>
> 컨텍스트 스위칭은 CPU나 코어에서 실행 중이던 프로세스나 스레드가 다른 프로세스나 스레드로 교체되는 과정으로, 멀티태스킹 시스템에서 여러 작업을 효율적으로 관리하기 위해 필수적인 메커니즘이다.
>
> 프로세스 컨텍스트 스위칭은 다른 프로세스에 속한 스레드 간의 컨텍스트 스위칭이고, 스레드 컨텍스트 스위칭은 같은 프로세스에 속한 스레드 간의 컨텍스트 스위칭이다.
>
> 이들은 운영체제의 커널 모드에서 수행되며, 현재 실행 중인 레지스터의 상태를 저장하고 다음 작업의 레지스터 상태를 복원한다.
>
> 스레드 컨텍스트 스위칭은 메모리 영역을 공유해 스위칭을 발생해도 메모리 관련 작업이 발생하지 않지만, 프로세스 컨텍스트 스위칭은 MMU가 새로운 프로세스의 주소 체계를 바로보도록 수정하고, TLB라는 가상 메모리 주소와 실제 메모리 주소의 매핑 정보를 들고 있는 캐시도 비워주는 추가적인 메모리 처리 작업이 필요하다.

### 1. 🤔 왜 사용하는가

- **컨텍스트 스위칭 (Context Switching)**

  - CPU나 코어에서 실행 중이던 프로세스나 스레드가 다른 프로세스나 스레드로 교체되는 과정
  - 멀티태스킹 시스템에서 여러 작업 효율을 관리하기 위한 필수적인 메커니즘

- **컨텍스트 (Context)**
  - 프로세스나 스레드의 현재 상태
    - CPU의 레지스터 상태(프로그램 카운터, 스택 포인터 등)와 메모리 상태 포함
  - 프로세스/스레드가 실행을 중단하고 나중에 다시 시작할 때 필요한 모든 정보 담고 있음

### 2. 💡 무엇인지 아는가(특징)

> **컨텍스트 스위칭의 필요성**

- 멀티태스킹 시스템에서 여러 프로세스나 스레드가 동시에 실행되는 것처럼 보이도록,
  CPU가 짧은 시간 단위로 작업을 전환하며 여러 작업을 처리함
- 사용자는 여러 작업이 동시에 진행되는 것처럼 인식
- 시스템 자원을 효율적 활용 가능

> **컨텍스트 스위칭의 발생 시점**

1. **Time Slice (Quantum)를 다 사용했을 때**
   - 각 프로세스나 스레드에 할당된 CPU 시간이 다 소진되면 스위칭 발생
2. **I/O 작업 필요할 때**
   - 프로세스나 스레드가 I/O 작업을 수행해야 할 경우, CPU는 다른 작업 처리 위해 현재 작업 중단 후 스위칭 수행함
3. **우선순위 변경**
   - 더 높은 우선순위의 작업 발생 시 현재 작업을 중단하고 우선순위가 높은 작업으로 전환 가능

> **컨텍스트 스위칭 수행 주체**

- 운영체제의 커널(kernel)에 의해 수행
  - 커널
    - 시스템 자원 관리
    - 프로세스 및 스레드의 상태를 조정해 효율적인 작업 처리 담당

> **컨텍스트 스위칭의 과정**

- **프로세스 컨텍스트 스위칭 (다른 프로세스에 속한 스레드 간의 컨텍스트 스위칭)**

  1. 현재 프로세스의 상태 저장
     - 실행 중인 프로세스의 레지스터 상태와 메모리 정보 저장
  2. 다음 프로세스의 상태 로드
     - 스케줄러가 선택한 다음 실행할 프로세스의 저장된 상태 로드
  3. 프로세스 전환
     - CPU는 새로운 프로세스의 실행을 시작
  4. 추가 메모리 처리
     - 새로운 프로세스의 가상 메모리 주소 체계를 설정
     - MMU(Memory Management Unit)와 TLB(Translation Lookaside Buffer)를 업데이트

- **스레드 컨텍스트 스위칭 (같은 프로세스에 속한 스레드 간의 컨텍스트 스위칭)**
  1. 현재 스레드의 상태 저장
     - 실행 중인 스레의 레지스터 상태 저장
  2. 다음 스레드의 상태 로드
     - 동일한 프로세스 내에서 실행할 다음 스레드의 상태 로드
  3. 스레드 전환
     - CPU는 새로운 스레드의 실행 시작
  4. 메모리 처리 생략
     - 동일한 프로세스 내 스레드 간 전환이므로 메모리 관련 추가 처리 필요 없음

> **스레드 컨텍스트 스위칭이 프로세스보다 빠른 이유**

- 스레드 컨텍스트 스위칭
  - MMU 새로운 주소 체계 바로보도록 수정
  - 메모리 주소 관련 작업을 하지 않음
    - TLB 가상 메모리, 실제 메모리 저장된 캐시를 비우는 등
  - CPU의 상태 정보만 바꿔주면 됨

### 3. ✅ 공통점

> **프로세스와 스레드 컨텍스트 스위칭 공통점**

- **커널 모드에서 실행**
  - 컨텍스트 스위칭은 항상 운영체제의 커널 모드에서 수행
- **CPU 레지스터 상태 교체**
  - 현재 실행 중인 작업의 레지스터 상태를 저장하고, 다음 작업의 레지스터 상태를 복원함

### 4. ↔️ 차이점

> **프로세스와 스레드 컨텍스트 스위칭의 차이점**

1. **같은 프로세스에 속한 스레드들 간의 컨텍스트 스위칭**
   - 같은 프로세스에 속해 메모리 영역 공유
   - 스위칭 발생해도 메모리와 관련한 추가적인 작업이 발생하지 않음
2. **다른 프로세스에 속한 스레드 간의 컨텍스트 스위칭**
   - 메모리 프로세스간 메모리 주소 체계가 달라 메모리 주소 관련 처리를 추가적으로 수행해야 함
   - MMU(Memory Manage Unit) 또한 새로운 프로세스의 주소 체계를 바로보도록 수정 필요
   - TLB(Translation Lookaside Buffer)라는 가상 메모리 주소와 실제 메모리 주소의 매핑 정보를 들고 있는 캐시도 비워줘야 함
     - TLB 캐시를 비워주지 않을 경우
       → 이전에 작업했던 프로세스의 주소에 접근할 가능성 있음
