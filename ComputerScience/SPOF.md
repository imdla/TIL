> 💡 **한 줄 요약**
>
> SPOF는 전체 시스템에서 제대로 동작하지 않는 경우, 전체 시스템이 중단되는 특정 구성 요소를 의미한다. 시스템이 고가용성을 만족하기 위해 SPOF를 식별하고 개선하는 작업이 필요하다.

### 1. 🤔 왜 사용하는가

- **단일 장애 지점(Single Point of Failure, SPOF)**

  - 전체 시스템에서 제대로 동작하지 않는 경우, 전체 시스템이 중단되는 특정 구성 요소
  - 시스템이 고가용성 만족하기 위해 SPOF를 식별하고 개선하는 작업 필요

- **가용성(Availability)**
  : 서버와 네트워크, 프로그램 등 정보 시스템이 정상적으로 사용할 수 있는 정도
  - 가용성
    = 정상적인 사용 시간(Uptime) / 전체 사용 시간(Uptime+Downtime)
  - **고가용성 (Hight Availability, HA)**
    - 가용성이 99.999% 처럼 높은 경우

### 2. 💡 무엇인지 아는가(특징)

> **SPOF를 식별하고 개선해야 하는 상황**

```
1. API Server는 1대를 운용
2. DB는 Master Replica 구성을 사용
3. Master DB는 1대이며, 3대의 Replica DB를 사용 (Failover는 지원됨)
```

- 현재 서버가 단일 서버로 구성되어 있음
- OOM(Out Of Memory), 네트워크 장애, 자원 고갈, 하드웨어 장애와 같은 문제 발생 시 서버의 고장이 전체 시스템의 고장으로 이어질 수 있음
- **문제 개선**
  - 서버 이중화, 로드 밸런서 사용
    - **이중화** : 동일한 애플리케이션을 여러 서버에 배포해 한 서버가 다운되더라도 다른 서버가 서비스를 제공할 수 있도록 함
    - **로드 밸런서** : 서버에 들어오는 트래픽을 여러 서버로 분산시켜주는 역할
      - 특정 서버가 고장날 경우 로드 밸런서에서 해당 서버로 향하는 요청을 다른 정상 서버로 전달함

> **서버 이중화 시 점검해야할 부분**

- 서버 이중화 시 점검해야 할 지점들은 애플리케이션 특성에 따라 상이
- 대표적 부분 : 동시성 문제, 세션 불일치 문제, 로그 및 메트릭 수집, 로드 밸런싱 알고리즘, 배포 등
  1. 애플리케이션 내부에서 동시성 문제 해결 위한 코드가 이중화 환경에서도 안전하게 작동하는지 점검 필요성 있음
     - **단일 서버의 경우**
       - 자바의 synchronized, ReentrantLock을 사용해 멀티 스레드 환경에서 동시성 문제 해결할 수 있음
     - **이중화된 환경의 경우**
       - 해당 방법들이 제대로 동작하지 않을 가능성이 매우 높음
       - 분산 잠금이나 DB 잠금을 사용하는 것이 적절
  2. **서버에서 세션 기반 인증 사용할 경우, 세션 불일치 문제 겪을 수 있음**
     - 세션 클러스터링, 스티키 세션, 토큰 기반 인증, 외부 세션 저장소 등 고려 필요
  3. **서버에서 생성되는 로그와 메트릭 데이터가 여러 서버에 걸쳐 쌓이게 됨**
     - 해당 데이터를 시각화하여 한눈에 확인하기 위해 각 서버에서 발생되는 데이터를 수집 및 통합해 관리할 필요성이 생김
  4. **적절한 로그 밸런싱 알고리즘 선택**
     - 비효율적인 로드 밸런싱 알고리즘 사용 시, 한 서버에만 요청이 몰려 이중화와 로드 밸런싱을 적용한 의미 퇴색할 수 있음
  5. **서버 배포에 대해 고민해볼 필요성**
     - 서버 증가할수록, 동일한 서비스의 다양한 버전이 운영될 수 있음
     - 배포 시간이 증가하거나 배포 중 장애에 대한 대응이 복잡해질 수 있음
