> 💡 **한 줄 요약**
>
> DB Replication은 데이터베이스의 고가용성과 데이터 안정성을 보장하기 위해 널리 활용되는 기술이다. 데이터의 지속적 가용성 및 신뢰성이 중요해 원본 서버와 복제 서버 간의 데이터 동기화를 위해 사용된다. Relication은 원본 서버에서 발생하는 모든 데이터 변경 사항을 Replica 서버로 복제해 두 서버 간의 데이터 일관성을 유지한다.

### 1. 🤔 왜 사용하는가

- **DB Replication**
  - 데이터베이스의 고가용성과 데이터 안정성을 보장하기 위해 널리 활용되는 기술
  - 주로 대규모 애플리케이션 환경에서는 데이터의 지속적인 가용성, 신뢰성이 매우 중요
    ⇒ 원본(Source)와 서버와 ↔ 복제(Replica) 서버 간의 데이터 동기화가 필수

### 2. 💡 무엇인지 아는가(특징)

> **바이너리 로그(Binary log) 저장 방식**

- **Replication**
  - Source 서버에서 발생하는 모든 데이터 변경 사항을
    → Replica 서버로 복제 (두 서버 간의 데이터 일관성 유지하는 메커니즘)
  - **Binary log 기반**
    - Source 서버에서 실행된 모든 데이터 변경 쿼리 기록하는 역할
    - **MySQL 에서 Binary log 저장하는 방식**
      1. Row
      2. Statement
      3. Mixed

1. **Row 방식**

   - 데이터베이스의 각 행별로 변경된 내용을 정확히 기록
   - ex. 특정 행이 수정될 경우
     - 그 행의 이전 상태와 변경된 상태 모두 기록
     - 복제 서버에서도 원본 서버와 동일한 데이터 상태 유지 가능
   - 장점
     - 데이터 일관성을 매우 높게 유지할 수 있음
   - 단점
     - 모든 행의 변경 사항을 저장 → Binary log 파일의 크기 급격히 증가
     - 저장 공간에 부담줄 수 있음

1. **Statement 방식**

   - 데이터 변경을 일으킨 SQL 문 자체를 Binary log에 기록
   - ex. SELECT NOW()와 같은 함수는 실행 시점에 따라 다른 결과 반환 가능
     - 이를 포함한 쿼리는 복제 시 문제 될 수 있음
   - 장점
     - 로그 파일의 크기를 상대적으로 작게 유지 가능
     - 저장 공간 절약 가능
   - 단점
     - 실행할 때 마다 다른 값으로 반환하는 함수와 같이
       비확장적(non-deterministic) SQL 쿼리 실행될 경우 - 동일한 쿼리가 Source와 Replica 서버에서 다른 결과를 초래 가능 - 데이터 불일치 문제 발생 가능

1. **Mixed 방식**
   - 위의 문제 보완하기 위함
   - 상황에 따라 row 기반과 statement 기반을 혼합해 로그를 기록
   - 비확장적 SQL이 아닌 경우
     - statement 방식 사용해 저장 공간 절약
   - 비확장적 SQL이 실행되는 경우
     - row 방식을 사용해 데이터 일관성 유지함
   - 장점
     - 위의 두 방식의 장점을 모두 활용 가능
     - 데이터 불일치 문제 최소화 가능
   - 단점
     - 구현 다소 복잡함

> **복제 과정**

1. Source 서버에서 데이터 변경 쿼리 실행
2. 선택된 로그 저장 방식에 따라 Binary log에 기록
3. Replica 서버의 IO Thread가 Binary log를 읽어옴

   → Replica 서버의 Relay log로 전송

   - **Relay log**
     - Replica 서버에서 Source 서버의 Binary log를 저장하는 임시 저장소 역할

4. 저장된 로그를 기반으로 Replica 서버의 SQL 스레드가 실제 데이터베이스에 변경 사항 적용

- 이 과정은 매우 효율적으로 설계됨
  - 일반적으로 약 100밀리초 이내에 데이터 동기화 완료됨
- 빠른 동기화 속도로 원본과 복제 서버 가느이 데이터 일관성이 실시간에 가깝게 유지 가능
